%!TEX root = thesis.tex
\chapter{Theoretical Limits for LM \label{ch:Theoretical-limits-of the LM}}

In this chapter, we discuss the resolution limit and its application to localisation microscopy (LM) from the theoretical point of view. 

In \autoref{sec:FREM} we compare the classical resolution limit with fundamental resolution measure (FREM), introduced by Ram et al. \cite{Ram2006}. FREM accommodates the resolution criterion for situation of pixelated data corrupted with noise. \Autoref{sec:CR} introduces the \CR (CR) lower bound as a theoretical framework for description of the estimator covariance matrix. In \autoref{sec:FREM orig} we use the CR lower bound to show the derivation of the Ram's original FREM formula. We also discuss the limitations and problems of the original FREM. In \autoref{sub:An-alternative-derivation-FREM} we derive an alternative version of FREM and demonstrate that this version fixes strange and inconsistent behaviour of the original FREM. Throughout the chapter we use our version of FREM. We call the Ram's version the ``original FREM" and denote it as \f{orig}. Our alternative version is denoted as \f{static}. In \autoref{sec:FREM for blinking} we derive \f{blink} for two emitters with intermittent intensity. This expression is relevant to localisation microscopy with blinking fluorophores, such as QDs (discussed in \autoref{ch:NMF}). The parameters used for data simulation are discussed in \autoref{sec:FREM simulations}. \Autoref{sec:FREM results} compares FREM for blinking and static sources in different experimental conditions and identifies the regions and experimental parameters setting, where the intermittent behaviour of the intensity allows considerable higher resolution. The discussion of the results is in \autoref{sec:FREM discussion}. 

Details of the derivations can be found in \autoref{app:Appendix2}.
\afterpage{\clearpage}
%==========================================
%==========================================

\section{Fundamental resolution measure (FREM)\label{sec:FREM}}

The classical resolution limit \autoref{eq:Airy} discussed in \autoref{sec:Resolution limit} relates to an empirical observation and does not take into account the statistical nature of the photon detection process. The classical resolution limit applies to a noise-free situation and neglects the pixelation of data. 

Ram et al. \cite{Ram2006,Ram2006b} revised the resolution limit and defined a new measure, which considers the statistical process of photon detection on a pixelated grid of a camera. The so-called \emph{Fundamental resolution measure} (FREM) refers to the achievable precision of the estimator on distance between two sources. FREM reflects the fact, that the ``resolution limit'' is different for sources with different noise levels. If we want to ``resolve'' two sources, the necessary separation must be larger for noisy data (weak emitters with high background) than for data with high signal-to-noise ratio (bright sources with low background values).

Ram et al. defined FREM as the \CR (CR) lower bound on the standard deviation of the source separation estimator. FREM therefore does not provide ``resolution criterion'' such as \autoref{eq:Airy}, but gives us a notion about variability we can expect if we try to measure the distance between two emitters. We can set the ``resolution'' limit arbitrarily according to the measurement precision we are willing to accept. A natural choice for the ``acceptable precision'' is the distance between the sources. I.e. the standard deviation of the source separation measurement is equal to the separation itself. We use this ``natural resolution criterion'' throughout this chapter. 

It is important to note that FREM defined as the CR lower bound does not consider any specific algorithm for the estimation of the source separation. FREM is derived from the generative model of the dataset.  The standard deviation lower bound can be achieved only with the ``optimal'' algorithm. 

%For the standard LM techniques such as PALM and STORM \cut{(\autoref{sub:PALM,-STORM})} the spatial resolution limit is determined by the localisation precision for an individual source, because only individual, well separated sources are considered for localisation. 

%The \CR lower bound for the position estimation of a single source detected by a CCD camera is derived in \cite{Ram2006,Ram2006b}. The variance is shown to be proportional to $1/\Lambda$, where $\Lambda$ is the number of photons emitted by the source. 

%==========================================
%==========================================

\section{\CR lower bound\label{sec:CR}}

\CR lower bound is a theoretical framework for description of the estimator covariance matrix. If $\mathcal{L}(\theta)=\log p(x|\theta)$ is a log-likelihood function for data $X$, then a covariance matrix $\bm{Q}$ of an unbiased estimator of $\hat{\theta}$ is bounded by \cite{Rao1945,Cover1991} 
%
\begin{equation}
	\bm{Q}\geq\bm{I}^{-1}(\theta),
	\label{eq:Covariance vs Fisher information}
\end{equation}
%
where the Fisher information matrix $\bm{I}(\theta)$ can be expressed in two equivalent formulas
%
\begin{equation}
	I_{ij}(\theta)=-\E\left[\frac{\partial^2\mathcal{L}}{\partial\theta_i\partial\theta_j}\right]=\E\left[\frac{\partial\mathcal{L}}{\partial\theta_i}\frac{\partial\mathcal{L}}{\partial\theta_j}\right].
	\label{eq:Fisher information general}
\end{equation}

The inequality \autoref{eq:Covariance vs Fisher information} is in the sense that $\bm{Q}-\bm{I}^{-1}(\theta)$ is a non-negative definite matrix.

%==========================================
%==========================================
\section{Original FREM formula (\f{orig})\label{sec:FREM orig}}

Ram et al. \cite{Ram2006} considered two sources separated by a distance $d$ and derived the Fisher information
%
\begin{equation}
	I(d)=\frac{1}{4}\sum_{k=1}^N\frac{\left[\Lambda_1q_k'(-\frac{d}{2})-\Lambda_2q_k'(\frac{d}{2})\right]^2}{\Lambda_1q_k(-\frac{d}{2})+\Lambda_2q_k(\frac{d}{2})+b},
	\label{eq:Ram FREM}
\end{equation}
%
where $\Lambda_i$ is the intensity of the $i$th source, $b$ is the background level in each pixel, $q_k(z)=\int_{\Gamma_k}q(x-z)dx$ is the pixelated version of a point spread function translated by $z$ with $\Gamma_k$ being the region of the $k$th pixel. The corresponding pixelated derivative is $q'_k(z)=\int_{\Gamma_k}\frac{\partial q(x-z)}{\partial x}dx$. 

The inverse of the Fisher information bounds the variance of the estimator on $d$ 
%
\begin{equation}
	\var(d)\geq I^{-1}(d).
\end{equation}
%
\f{orig} as a lower bound on the standard deviation is therefore
%
\begin{equation}
	\unit{\f{orig}}=\sqrt{I^{-1}(d)}.
	\label{eq:FREM}	
\end{equation}

A short summary of the derivation is shown in \autoref{app:Appendix2}. 

Closer inspection of \f{orig} derived from the Fisher information given by \autoref{eq:Ram FREM} reveals problematic behaviour of \f{orig} in the limits $d\rightarrow 0$ (see discussion in \autoref{app:Appendix2}). The limit of very close emitters $d\rightarrow0$ gives, as we would expect, zero Fisher information $I(d)\rightarrow0$, and therefore \f{orig}$\rightarrow\infty$. However, this is only for situation, when the sources have equal intensities $\Lambda_1=\Lambda_2$. For emitters of unequal strength $\Lambda_1\neq\Lambda_2$ the variance remains finite even for sources infinitely close. 

Another problem with this expression is that the sources are assumed to be located at $\pm d/2$, which implies the knowledge of the origin. It is therefore not surprising that the formula \autoref{eq:Ram FREM} gives non-zero Fisher information $I(d)\neq0$ (i.e. finite \f{orig}) even when one source is missing ($\Lambda_i=0$), because, in fact, only one source is needed to determine the distance $d/2$. 

In the following section we present an alternative derivation of FREM, which resolves these problems. In contrast to the original \f{orig} our version gives diverging FREM for $d\rightarrow0$ even for sources with different intensities. It also diverges in the situation when one of the sources is missing. For sources with equal intensities $\Lambda_1=\Lambda_2$ our version and the original version of \f{orig} give identical results. 

%==========================================
%==========================================

\section{An alternative derivation of FREM (\f{static})\label{sub:An-alternative-derivation-FREM}} 
 
We assume two sources located along a line at positions $c_1$ and $c_2$ with intensities $\Lambda_1$ and $\Lambda_2$, respectively. If both sources have identical PSFs (here denoted as $q(x)$) we can express the intensity as:
%
\begin{equation}
	\lambda(\bm{c})=\Lambda_1q(x-c_1)+\Lambda_2q(x-c_2).
	\label{eq:lambda}
\end{equation}
%
The distance between the two sources is $d=c_1-c_2$, which is a linear combination $\bm{a}^{T}\cdot\bm{c}$ of the variable $\bm{c}=(c_1,c_2)^{T}$, where $\bm{a}=(1,-1)^{T}$. The variance of $d$ is therefore given by 
%
\begin{alignat}{2}
	\var(d)
	&=\var(\bm{a}^{T}\cdot\bm{c})\nonumber\\
	&=\bm{a}^{T}\cdot\bm{Q}\cdot\bm{a},
	\label{eq:var d from Q}
\end{alignat}
%
where $\bm{Q}$ is the covariance matrix with lower bound given by the inverse of the Fisher information matrix (see \autoref{eq:Covariance vs Fisher information} and \autoref{eq:Fisher information general}):
%
\begin{equation}
	\bm{Q}\geq\bm{I}^{-1}(\bm{c})=\frac{1}{I_{11}I_{22}-I_{12}^2}\left(
	\begin{array}{cc}
		I_{22} & -I_{12}\\
		-I_{12} & I_{11}
	\end{array}\right).
	\label{eq:inverse I}
\end{equation}
%
Expressing the elements of the covariance matrix $\bm{Q}$ from \autoref{eq:inverse I} and substitution to \autoref{eq:var d from Q} gives the expression for $\var(d)$ from the elements of the Fisher information matrix
%
\begin{alignat}{2}
	\var(d)
	&=Q_{11}+Q_{22}-2Q_{12}\nonumber\\
	&\geq\frac{I_{11}+I_{22}+2I_{12}}{I_{11}I_{22}-I_{12}^2}.
	\label{eq:variance d alternative}
\end{alignat}

We assume that the recorded images are corrupted with Poisson noise only (denoted here as $\Po(n;\lambda)$, or sometimes in a shorter version $\Po(\lambda)$, leaving only the expectation value $\lambda$ as an argument). The probability distribution of $n_k$ photons detection in the $k$th pixel is therefore
%
\begin{equation}
	p(n_k|\bm{c})=\Po\left(n_k;\lambda_k(\bm{c})\right),
\end{equation}
%
where $\lambda_k$ is the expected intensity in pixel $k$. It is obtained by integration of the intensity distribution $\lambda(x)$ from \autoref{eq:lambda} over the area of a pixel $\Gamma_k$:
%
\begin{equation}
	\lambda_k(\bm{c})=\int_{\Gamma_k}\Lambda_1q(x-c_1)+\Lambda_2q(x-c_2)dx+b.	
	\label{eq:intensity pixel}
\end{equation}
%
The constant $b$ is a homogeneous background in each pixel.

If we suppose uncorrelated noise between pixels, we get the log-likelihood function for $N$ pixels: 
%
\begin{equation}
	\mathcal{L}=\sum_{k=1}^N\log p(n_k|\bm{c})=\sum_{k=1}^N\log\left[\Po\left(n_k;\lambda_k(\bm{c})\right)\right].
	\label{eq:FREM likelihood Poisson}
\end{equation}
%
Inserting $\mathcal{L}$ into \autoref{eq:Fisher information general}, the elements of the Fisher information matrix become (see \autoref{eq:app-Fisher Information alternative - Individual} in \autoref{app:Appendix2} for details)
%
\begin{equation}
	I_{ij}(\bm{c})=\sum_{k=1}^N\frac{1}{\lambda_k}\frac{\partial\lambda_k}{\partial c_i}\frac{\partial\lambda_k}{\partial c_j};\; \ i,j\in\{1,2\}.
	\label{eq:FI - entries}
\end{equation}
%
By substitution from \autoref{eq:intensity pixel} we get for the individual elements of the Fisher information matrix (see \autoref{eq:app-Fisher Information alternative - Individual} in \autoref{app:Appendix2} for details): 
%
\begin{equation}
	I_{ij} =\Lambda_i\Lambda_j\sum_{k=1}^N\frac{q'_k(c_i)q'_k(c_j)}{\Lambda_1q_k(c_1)+\Lambda_2q_k(c_2)+b};\; \ i,j\in\{1,2\},
	\label{eq:FI - individual}
\end{equation}
%
where $q_k(c_i)$ and $q'_k(c_i)$ are the pixelated versions (pixel area $\Gamma_k$) of the PSF and the derivative, respectively:
%
\begin{alignat*}{2}
	q_k(c_i) & =\int_{\Gamma_k}q(x-c_i)dx\\
	q'_k(c_i) & =\int_{\Gamma_k}\frac{\partial q(x-c_i)}{\partial x}dx.
\end{alignat*}

For equally strong sources ($\Lambda_1=\Lambda_2=\Lambda$) we get a compact expression for the entries of the Fisher information: 
%
\begin{equation}
	I_{ij} =\Lambda\sum_{k=1}^N\frac{q'_k(c_i)q'_k(c_j)}{q_k(c_1)+q_k(c_2)+b/\Lambda};\; \ i,j\in\{1,2\},
	\label{eq:FI - individual - equal strength}
\end{equation}
%
and due to the symmetry of the entries ($I_{11}=I_{22}$ and $I_{12}=I_{21}$) the variance \autoref{eq:variance d alternative} can be expressed as
%
\begin{equation}
	\var(d)\geq\frac{2}{I_{11}-I_{12}}.
	\label{eq:var symmetric}
\end{equation}
%
Inserting the matrix elements \autoref{eq:FI - individual - equal strength} into \autoref{eq:var symmetric} shows that for situations where the background level is considerably smaller than the intensity $b/\Lambda\ll1$, the lower bound on variance scales with the sources' intensity $\Lambda$ as
%
\begin{equation}
	\var(d)\propto\frac{1}{\Lambda}. 
\end{equation}
%
However, the exact value depends on the shape of the PSF $q(x)$.

In \autoref{app:Appendix2} we show the equivalence of the original \f{orig} \autoref{eq:Ram FREM} and our version \autoref{eq:FI - individual} for sources with equal strength ($\Lambda_1=\Lambda_2$). However, as we demonstrate in \autoref{sec:comparison orig and new FREM}, the expression gives very different results for sources of unequal intensity. 

\f{static} computed from \autoref{eq:FI - individual} have reasonable behaviour in the limits $d\rightarrow0$ and $d\rightarrow\infty$ (see \autoref{sec:Appendix FI alternative} for details). The limit of very close sources ($d\rightarrow0$) gives \f{static}$\rightarrow\infty$ for any value of $\Lambda_i$ and $\Lambda_j$. Also, in contrast to the original \f{orig} expression, our \f{static} diverges if one of the sources is missing $\Lambda_i=0$, because we do not make any assumption about the symmetry with respect to the origin. 

For well-separated sources ($d\rightarrow\infty$) the off-diagonal elements of the Fisher information matrix vanish ($I_{ij}=0$ for $i\neq j$) and from \autoref{eq:variance d alternative} we get
%
\begin{equation}
 	\var(d)\geq\frac{1}{I_{11}}+\frac{1}{I_{22}}.
\end{equation}
%
Fraction $1/I_{ii}$ is the lower bound on the variance of the single source location $c_i$ estimator. This can be obtained from the general expression of the Fisher information for Poisson distributed data (see \autoref{eq:app-Fisher Info for Poisson} in \autoref{app:Appendix2}). The bound on the total variance is therefore composed from the sum of bounds on variances for localisation of individual sources, as we expect.


%==========================================
%==========================================

\section{FREM for blinking sources (\f{blink})\label{sec:FREM for blinking}}

Fundamental resolution measure discussed in the previous section considers only the total number of photons $\Lambda_i$ emitted by each source $s_i$. In this section we derive \f{blink} for sources with intermittent intensity and compare it to the ``static'' \f{static} derived above. 

To address this question we assume a simple model of Poisson distributed data with expected pixel values $\lambda_k$ (\autoref{eq:intensity pixel}). To account for the intermittent behaviour of the intensity, we turn the intensity vector $\bm{\Lambda}=(\Lambda_1,\Lambda_2)$ into a random variable distributed over four distinctive states (indexed with a superscript $\alpha$):
%
\begin{equation}
	\left\{ \bm{\Lambda}^{\alpha=1}=(\Lambda_1,0),\,\bm{\Lambda}^{\alpha=2}=(0,\Lambda_2),\,\bm{\Lambda}^{\alpha=3}=(\Lambda_1,\Lambda_2),\,\bm{\Lambda}^{\alpha=4}=(0,0)\right\},
	\label{eq:intensity states}
\end{equation}
%
which is a simple model of, for example, two blinking quantum dots. The expected intensity in the $k$th pixel when $\bm{\Lambda}$ is in the state $\bm{\Lambda}^\alpha$ is then $\lambda_k^\alpha=\lambda_k(\bm{\Lambda}^\alpha)$:
%
\begin{alignat}{4}
	\lambda_k^{\alpha=1}&=\Lambda_1q_k(x-c_1) & &+b,\nonumber\\ 
	\lambda_k^{\alpha=2}&=&\Lambda_2q_k(x-c_2) &+b,\nonumber\\ 
	\lambda_k^{\alpha=3}&=\Lambda_1q_k(x-c_1)&+\Lambda_2q_k(x-c_2)&+b,\nonumber\\ 
	\lambda_k^{\alpha=4}&=& &+b,
	\label{eq:lambda states}
\end{alignat}
%
where homogeneous background $b$ was added to each pixel.

%==========================================
\subsection{Averaging the Fisher information\label{sub:avg FI}}

The ``averaging'' of the Fisher Information matrix presented in this section assumes knowledge of the intensity state (ON/OFF) of each source in every acquired frame. This information is not accessible in the real situation. However, we show the derivation to emphasise the difference between this approach and the more realistic situation, where the intensity states are described by probability distribution (\autoref{sub:FI int out}). 

If the intensity states $\bm{\Lambda}$ \emph{were known}, we would write the log-likelihood function as 
%
\begin{equation}
	\mathcal{L}(\theta,\Lambda)=\sum_{k=1}^N\log\left(l_k(\theta,\bm{\Lambda})\right).
\end{equation}
%
and the expected Fisher information matrix would become an average over the individual known states (see \autoref{app:Appendix2} for details)
%
\begin{equation*}
	I(\theta) = \int_{\bm{\Lambda}}p(\bm{\Lambda})I(\theta,\bm{\Lambda})d\bm{\Lambda},
\end{equation*}
%
where  $p(\bm{\Lambda})$ is the distribution of the $\bm{\Lambda}$ states and $I(\theta,\bm{\Lambda})$ is the Fisher information computed for a specific value of $\bm{\Lambda}$ (see \autoref{eq:intensity pixel} and \autoref{eq:FI - entries}).
%
For discrete states of $\bm{\Lambda}^\alpha$ shown in \autoref{eq:lambda states} we get
%
\begin{equation}
	I(\theta)=\sum_{\alpha}p(\bm{\Lambda}^\alpha)I(\theta,\bm{\Lambda}^\alpha),
	\label{eq:FI avg}
\end{equation}
%
where the Fisher Information for every configuration of $\bm{\Lambda}^\alpha$ is averaged with weights $p(\bm{\Lambda}^\alpha)$. 


%%
%\begin{equation}
%	I_{ij}(\bm{c})=\sum_{t=1}^T\sum_{\alpha=1}^4p(\bm{\Lambda}^\alpha_t)\sum_{k=1}^N\frac{1}{\lambda_k(\bm{c},\bm{\Lambda}^\alpha_t)}\frac{\partial\lambda_k(\bm{c},\bm{\Lambda}^\alpha_t)}{\partial c_i}\frac{\partial\lambda_k(\bm{c},\bm{\Lambda}^\alpha_t)}{\partial c_j},
%	\label{eq:Fisher Information Blinking Cheating}
%\end{equation}
%%
%which is the expectation value (with respect to the states $\bm{\Lambda}$) of the Fisher information matrix \autoref{eq:FI - entries} for each time frame, followed by the summation over all frames.

%==========================================

\subsection{Integrating over the intensity states\label{sub:FI int out}}
%
However, we assume that the variable $\bm{\Lambda}$ is fully described by the probability $p(\bm{\Lambda})$ over the states. The exact state in time frame is unknown. Therefore we have to integrate over $\bm{\Lambda}$. The likelihood function is then
%
\begin{alignat}{2}
	l(\theta)
	&=\prod_{k=1}^Np(n_k|\theta)\nonumber\\
	&=\prod_{k=1}^N\int_{\bm{\Lambda}}p(n_k,\bm{\Lambda}|\theta)\nonumber\\
	&=\prod_{k=1}^N\sum_{\alpha=1}^4p(n_k|\theta,\bm{\Lambda}^\alpha)p(\bm{\Lambda}^\alpha).
	\label{eq:FREM likelihood Lambda integrated out}
\end{alignat}
%
This complicates the evaluation of the Fisher information matrix \autoref{eq:Fisher information general} because of the summation within the logarithm in the log-likelihood
%
\begin{equation}
	\mathcal{L}(\theta)=\log l(\theta)=\sum_k\log\left(\sum_{\alpha=1}^4p(n_k|\theta,\bm{\Lambda}^\alpha)p(\bm{\Lambda}^\alpha)\right).
	\label{eq:log likelihood integrated out}
\end{equation}
%
In \autoref{app:Appendix2} we show that the Fisher information matrix for uniform distribution $p(\bm{\Lambda}^\alpha)=\frac{1}{4}$ over the four intensity states \autoref{eq:intensity states} is given by
%
\begin{equation}
	I_{rs}(\theta) =\sum_{k=1}^N\E_k\left[\frac{\left(\sum_{\alpha=1}^4\frac{\partial\Po(\lambda_k^\alpha)}{\partial c_r}\right)\left(\sum_{\alpha=1}^4\frac{\partial\Po(\lambda_k^\alpha)}{\partial c_s}\right)}{\left(\sum_{\alpha=1}^4\Po(\lambda_k^\alpha)\right)^2}\right],
	\label{eq:Fisher Information Blinking Integrating Out}
\end{equation}
%
where $\E_k\left[.\right]$ represents the expectation value with respect to $p(n_k,\bm{\Lambda}|\theta)$ (see \autoref{eq:log likelihood integrated out}). 

Expressing the derivatives and the expectation value gives
%
\begin{alignat}{2}
	I_{rs}(\theta)
	&=\frac{1}{4}\sum_{k=1}^N\left(\frac{\partial\lambda_k^{\alpha=r}}{\partial c_r}\right)\left(\frac{\partial\lambda_k^{\alpha=s}}{\partial c_s}\right)\times \nonumber\\
	&\times \sum_{n_k\geq0}\left[\frac{\left(\sum_{\alpha\in \{r,3\}}\Po(n_k;\lambda_k^\alpha)\frac{(n_k-\lambda_k^\alpha)}{\lambda_k^\alpha}\right)\left(\sum_{\alpha\in \{s,3\}}\Po(n_k;\lambda_k^\alpha)\frac{(n_k-\lambda_k^\alpha)}{\lambda_k^\alpha}\right)}{\sum_{\alpha=1}^4\Po(n_k;\lambda_k^\alpha)}\right].
	\label{eq:FI-blinking}
\end{alignat}
%
In \autoref{app:Appendix2} we show that the limit $d\rightarrow0$ gives $\var(d)\rightarrow\infty$ and the limit $d\rightarrow\infty$ gives $\var(d)\geq\frac{1}{I_{11}}+\frac{1}{I_{22}}$. We also show, that for well-separated sources ($d\rightarrow\infty$) and negligible background ($b\ll\Lambda$) the variance $\var(d)$ is identical for both blinking and static situation, if the total number of emitted photons is kept constant. 
\afterpage{\clearpage}
%==========================================
%==========================================

\section{Experimental parameters and numerical evaluations\label{sec:FREM simulations}} 
We made a comparison of the original \f{orig} formula computed from the Fisher information \autoref{eq:Ram FREM} with our proposed fixed \f{static} formula computed from \autoref{eq:FI - individual}, for sources with static intensity. We also compared the static situation with \f{blink} for sources with intermittent intensity computed from \autoref{eq:FI-blinking}.

We considered $625\unit{nm}$ emission light wavelength and $1.2\unit{NA}$ objective. Images were pixelated with $80\times80\unit{nm}$ pixels. Various intensities of the emitters $\Lambda_i$ and pixel background levels $b$ were considered.

The pixelated version $q_k(c_i)$ of the continuous PSF $q(x-c_i)$ and the corresponding derivatives $q'_k(c_i)$ from \autoref{eq:Ram FREM} and \autoref{eq:FI - individual} were computed by summing $10\times10$ pixels of $10\times$ oversampled images (approximation of the continuous PSF $q(x)$ on the $8\times8 \unit{nm}$ grid). The pixelated $\lambda^\alpha_k$ in \autoref{eq:Fisher Information Blinking Integrating Out} was computed in a similar manner. 

The expectation values in \autoref{eq:Fisher Information Blinking Integrating Out} were evaluated using the expression \autoref{eq:FI-blinking}. The set of images for a range $n_k=[0..n_{max}]$ was computed to perform the summation $\sum_{n_k\geq0}$. The value of $n_{max}$ was set such that the Poisson cumulative distribution function $F(n)$ for the pixel with the maximum intensity satisfies $F(n>n_{max})>1-t$, with $t=10^{-6}$.
\afterpage{\clearpage}
%==========================================
%==========================================


\section{Results\label{sec:FREM results}}

We computed the FREM for simulated datasets corresponding to different experimental settings, such as the separation of the sources $d$, the total number of emitted photons by each source $\Lambda$ and the background offset $b$ in the recorded frames. FREM gives us the lower bound on the standard deviation ($\sqrt{\var(d)}$) for the measurement of the source separation $d$. The source separation equivalent to FREM ($d$=FREM) can be considered as a ``natural resolution limit'', which takes the statistical nature of the photon detection into account.

%==========================================
\subsection{Comparison of the original \f{orig} and proposed \f{static} formula\label{sec:comparison orig and new FREM}}

We compared \f{orig} computed from the original \autoref{eq:Ram FREM} and our proposed \f{static} \autoref{eq:FI - individual} formula of the Fisher information for two static sources. It can be shown (\autoref{app:Appendix2}), that if the sources have equal strength ($\Lambda_1=\Lambda_2$), both formulas give identical results. However, for unequal sources $\Lambda_1\neq\Lambda_2$ the FREM values differ significantly. 
%
\begin{figure}[!hbt]
	\centering
	\newcommand{\wf}{.49\textwidth}
	\includegraphics[width=\wf]{\qd gFREM/images/FREM_statVsRAM_longrange_bg100fix}
%	\begin{tabular}{cc}
%		\subfloat[FREM (fixed background 100 photons)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_statVsRAM_longrange_bg100fix}}
%		&\subfloat[ratio]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_staticVsRAM_ratio_longrange_bg100fix}}
%	\end{tabular}	
	\caption{Comparison of the original \f{orig} formula computed from \autoref{eq:Ram FREM} (dashed line) and our proposed \f{static} formula \autoref{eq:FI - individual} (solid line) for two sources with unequal intensities $\Lambda_2=2\Lambda_1$ and background $b=100$ photons/pixel. The black dotted curve corresponds to FREM=$d$ (``natural resolution limit''). This would be a straight line with unit gradient in a linear plot.} 
	\label{fig:Comparison FREM Ram and fix}
\end{figure}

The sources $s_i$ were represented with an in-focus PSF centred at $c_i$. The intensity of $s_2$ was set to double of the intensity of $s_1$: $\Lambda_2=2\Lambda_1$. Three different intensity levels $\Lambda_1=500,\,3000$ and $10^4$ photons with homogeneous background $b=100\unit{photons/pixel}$ were considered. \Autoref{fig:Comparison FREM Ram and fix} shows FREM (lower bound on $\sqrt{\var(d)}$) for a range of sources separations $d$ evaluated with the original \f{orig}, computed from \autoref{eq:Ram FREM} (dashed line) and our proposed \f{static} \autoref{eq:FI - individual} (solid line).

The \f{orig} formula gives consistently lower values then \f{static} (dashed curves are under the solid lines for the whole range of $d$ in \Autoref{fig:Comparison FREM Ram and fix}). The original \f{orig} (dashed curves) also tends to finite values even for $d\rightarrow 0$. We discuss this behaviour further in \autoref{sub:LL surface}. 

%==========================================

\subsection{FREM for static and blinking sources\label{sub:FREM static vs blinking}}
%
In order to compare the blinking situation \autoref{eq:Fisher Information Blinking Integrating Out} with the static case \autoref{eq:FI - individual} we evaluated \f{static} and \f{blink} as a function of the source separation $d$. For the blinking situation we considered equal strength of the sources
%
\begin{equation}
	\Lambda_1^{blink}=\Lambda_2^{blink}=2\Lambda
\end{equation}
%
and the homogeneous background $b^{blink}$ in each pixel of each frame. Because the sources are ``ON'' only in 50\% of the cases (see \autoref{eq:lambda states}), the total number of emitted photons per source per frame is $\Lambda$ on average. 

For the static case we considered the situation of two sources emitting with equal intensities. To keep the total number of emitted photons per frame equal to the blinking case, we set the intensity 
%
\begin{equation}
	\Lambda_1^{static}=\Lambda_2^{static}=\Lambda.
\end{equation}
%
The background values are equal for the blinking and the static case $b^{blink}=b^{static}$.
%
\begin{figure}[!hbt]
	\centering
	\newcommand{\wf}{.49\textwidth}
	\begin{tabular}{cc}
		\subfloat[FREM (fixed $b=$100 phot/pixel)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_longrange_bg100fix}
		\label{fig:FREM fixed bg}}
		%For bg=0 the ratio should converge to 1/sqrt(2)=0.7
		&\subfloat[Ratio of the curves form (a)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_ratio_longrange_bg100fix}
		\label{fig:FREM ratio fixed bg}}\tabularnewline
		\subfloat[FREM (fixed $\Lambda=1500$ photons)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_longrange_int3000fix}
		\label{fig:FREM fixed int}}		
		%For bg=0 the ratio should converge to 1/sqrt(2)=0.7
		&\subfloat[Ratio of the curves form (c)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_ratio_longrange_int3000fix}
		\label{fig:FREM ratio fixed int}}
	\end{tabular}	
	\caption{{\it Left:} FREM (a) for fixed background $b=100$ photons and three different intensities $\Lambda$ of the sources and (c) for fixed total number of emitted photons $\Lambda=1500$ and three different values of background $b$. Dashed lines correspond to the blinking situation \f{blink} \autoref{eq:Fisher Information Blinking Integrating Out}, solid lines correspond the static situation \f{static} \autoref{eq:FI - individual}. {\it Right:} Ratio $r$ of the static (solid) to blinking (dashed) curves showing how many times is \f{blink} lower compared to the \f{static}. The classical resolution limit $\delta$ (radius of an Airy disk) corresponds to $\delta=320$ nm.}	
	\label{fig:FREM static blinking}
\end{figure}
%
Comparison of FREM as a function of the separation $d$ for the blinking and the static case is shown in \autoref{fig:FREM static blinking}. Three different values of the total number of photons $\Lambda$ were considered in the semi-logarithmic plot \autoref{fig:FREM fixed bg}. All curves are computed for a fixed background level $b=100$ photons/pixel. 

The ratio of the FREM curves
%
\begin{equation}
	r=\frac{\f{static}(d)}{\f{blink}(d)}
	\label{eq:ratio}
\end{equation} 
%
for the blinking and the static case are shown in \autoref{fig:FREM ratio fixed bg}. The plot shows how many times is the \f{blink} lower when compared to the \f{static}. \Autoref{fig:FREM fixed int} shows the FREM curves for three different background values $b$. The total number of emitted photons per source was set to $\Lambda =1.5\cdot 10^3$ photons.

\f{blink} (dashed curves) is in general lower than \f{static}. The exception is a small region centred at around $300\unit{nm}$ (see \autoref{sub:Int out vs avg} for more discussion). The difference between the curves is most pronounced for closely spaced sources ($d<100\unit{nm}$) and data with high signal-to-noise ratio (red curves - bright sources with low background). 

\begin{figure}[!htb]
	\centering
	\newcommand{\wf}{.48\textwidth}
	\subfloat[\f{static}]{
	\includegraphics[width=\wf]{\qd gFREM/images/FREM_Static_sep40fix}
	\label{fig:FREM int bg static}
	}
	\subfloat[\f{blink}]{
	\includegraphics[width=\wf]{\qd gFREM/images/FREM_IntOut_sep40fix}
	\label{fig:FREM int bg blinking}
	}\\
	\subfloat[\f{static} - top view]{
	\includegraphics[width=\wf]{\qd gFREM/images/FREM_Static_flat_sep40fix}
	\label{fig:FREM int bg static top}
	}
	\subfloat[\f{blink} - top view]{
	\includegraphics[width=\wf]{\qd gFREM/images/FREM_IntOut_flat_sep40fix}
	\label{fig:FREM int bg blinking top}
	}
	\caption{{\it Top:} FREM for (a) static and (b) blinking situation for two sources separated by $d=40$ nm. {\it Bottom:} Top view on the surfaces. Red plane corresponds to situation when FREM is equal to the separation of the sources $d=40$ nm. The region, where the surface is above the red plane (in black) does not allow precise estimation of $d$ ($\unit{FREM}>d$). Examples of the data frames corresponding to the points in the $\Lambda \times b$ plane are shown in  \autoref{fig:two sources int bg}.}
	\label{fig:FREM int bg}
\end{figure}

%
For further comparison of the static and the blinking FREM, we fixed the separation between the two sources to $d=40\unit{nm}$ and computed FREM for a range of background $b$ and intensity  $\Lambda$ values. \Autoref{fig:FREM int bg} compares the static (left) with the blinking situation (right). The red plane corresponds to the ``natural'' resolution limit $\unit{FREM}=d$ (see \autoref{sec:FREM}), where the lower bound on standard deviation of the distance estimation $\sqrt{\var(d)}$ is equal to the separation $d$. In the region, where the black surface is above the red plane, the distance estimation is very imprecise. This region corresponds to the sources closer than the ``natural resolution limit''.  These (black) regions can be easily observed from the top view shown in the bottom plots of \autoref{fig:FREM int bg} demonstrating the increase of the ``resolution region'' for the blinking case.

\begin{figure}[!hbt]
	\centering
	\newcommand{\wf}{.14\textwidth}
	\newcommand{\dirim}{\qd gFREM/images/psf2/text_twosources_}
	\newcommand{\vs}{.4}
	\begin{tabular}{c|ccccc}
		\begin{sideways}\hspace{\vs cm}$b=300$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int2500_bg300}
		&\includegraphics[width=\wf]{\dirim int2000_bg300}
		&\includegraphics[width=\wf]{\dirim int1500_bg300}
		&\includegraphics[width=\wf]{\dirim int1000_bg300}
		&\includegraphics[width=\wf]{\dirim int500_bg300}\\
		\begin{sideways}\hspace{\vs cm}$b=200$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int2500_bg200}
		&\includegraphics[width=\wf]{\dirim int2000_bg200}
		&\includegraphics[width=\wf]{\dirim int1500_bg200}
		&\includegraphics[width=\wf]{\dirim int1000_bg200}
		&\includegraphics[width=\wf]{\dirim int500_bg200}\\
		\begin{sideways}\hspace{\vs cm}$b=100$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int2500_bg100}
		&\includegraphics[width=\wf]{\dirim int2000_bg100}
		&\includegraphics[width=\wf]{\dirim int1500_bg100}
		&\includegraphics[width=\wf]{\dirim int1000_bg100}
		&\includegraphics[width=\wf]{\dirim int500_bg100}\\
		\begin{sideways}\hspace{\vs cm}$b=10$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int2500_bg10}
		&\includegraphics[width=\wf]{\dirim int2000_bg10}
		&\includegraphics[width=\wf]{\dirim int1500_bg10}
		&\includegraphics[width=\wf]{\dirim int1000_bg10}
		&\includegraphics[width=\wf]{\dirim int500_bg10}\\
		\hline	
		&$\Lambda=2500$ & $\Lambda=2000$ & $\Lambda=1500$ & $\Lambda=1000$ & $\Lambda=500$\\
	\end{tabular}
	\caption{Illustration of two simulated sources separated by $d=40$ nm with intensity $\Lambda$ (total number of emitted photons per source per frame) and the background $b$. Data were corrupted with Poisson noise. The red dots indicate the positions of the sources. The layout corresponds to \autoref{fig:FREM int bg}. Numbers at the top and the bottom of each figure state the ratio (in percent) $r_B=\f{blink}/d\times100$ and $r_S=\f{static}/d\times100$ for the blinking and the static situation, respectively, indicating the how many percent of the separation $d$ represents the FREM value. The smaller the values, the higher the precision of the distance estimator.}
	\label{fig:two sources int bg}
\end{figure}
%
\Autoref{fig:two sources int bg} shows the noisy images of two sources with parameters $b$ and $\Lambda$ with layout similar to the graphs in \autoref{fig:FREM int bg}.  The black regions from \autoref{fig:FREM int bg static top} and \autoref{fig:FREM int bg blinking top} correspond to extremely noisy data (top right corner) and the high FREM values are not surprising. 

For high signal-to-noise ratio data (high $\Lambda$ and low $b$,  see bottom-left corner of \autoref{fig:FREM int bg} and \autoref{fig:two sources int bg}) the lower bound on the standard deviation of the separation $d=40\unit{nm}$ estimation can be as low as $7\unit{nm}$ for the blinking case \f{blink} (\autoref{fig:FREM int bg blinking}). \f{static} are approximately three times higher ($\sim 20\unit{nm}$,  \autoref{fig:FREM int bg static}). Note that the \f{blink} surface in \autoref{fig:FREM int bg blinking} for the blinking situation has much steeper increase from the sub $40\unit{nm}$ region than the surface for the static case \autoref{fig:FREM int bg static}.

%\clearpage
%\begin{figure}[!bt]
%	\centering
%	\newcommand{\wf}{.15\textwidth}
%	\newcommand{\dirim}{\qd gFREM/images/psf2/text_}
%	\newcommand{\vs}{.4}
%	\begin{tabular}{c|ccccc}
%		\begin{sideways}\hspace{\vs cm}$b=300$\end{sideways}
%		&\includegraphics[width=\wf]{\dirim int2500_bg300}
%		&\includegraphics[width=\wf]{\dirim int2000_bg300}
%		&\includegraphics[width=\wf]{\dirim int1500_bg300}
%		&\includegraphics[width=\wf]{\dirim int1000_bg300}
%		&\includegraphics[width=\wf]{\dirim int500_bg300}\\
%		\begin{sideways}\hspace{\vs cm}$b=200$\end{sideways}
%		&\includegraphics[width=\wf]{\dirim int2500_bg200}
%		&\includegraphics[width=\wf]{\dirim int2000_bg200}
%		&\includegraphics[width=\wf]{\dirim int1500_bg200}
%		&\includegraphics[width=\wf]{\dirim int1000_bg200}
%		&\includegraphics[width=\wf]{\dirim int500_bg200}\\
%		\begin{sideways}\hspace{\vs cm}$b=100$\end{sideways}
%		&\includegraphics[width=\wf]{\dirim int2500_bg100}
%		&\includegraphics[width=\wf]{\dirim int2000_bg100}
%		&\includegraphics[width=\wf]{\dirim int1500_bg100}
%		&\includegraphics[width=\wf]{\dirim int1000_bg100}
%		&\includegraphics[width=\wf]{\dirim int500_bg100}\\
%		\begin{sideways}\hspace{\vs cm}$b=10$\end{sideways}
%		&\includegraphics[width=\wf]{\dirim int2500_bg10}
%		&\includegraphics[width=\wf]{\dirim int2000_bg10}
%		&\includegraphics[width=\wf]{\dirim int1500_bg10}
%		&\includegraphics[width=\wf]{\dirim int1000_bg10}
%		&\includegraphics[width=\wf]{\dirim int500_bg10}\\
%		\hline
%		&$\Lambda=2500$ & $\Lambda=2000$ & $\Lambda=1500$ & $\Lambda=1000$ & $\Lambda=500$\\
%	\end{tabular}
%	\caption{Illustration of a simulated source with intensity $\Lambda$ (total number of emitted photons) and background level $b$ corrupted with Poisson noise. Red dot indicates the position of the source. The numbers $p$ in each frame shows the lower bound on localisation precision $p=\sqrt{var(c_1)}$ along one direction.}
%	\label{fig:PSF int bg}
%\end{figure}
%
\afterpage{\clearpage}

\begin{figure}[!bh]
	\centering
	\newcommand{\wf}{.45\textwidth}
	\subfloat[b=100]{
	\includegraphics[width=\wf]{\qd gFREM/images/FREMdip_conjgrad_Lambda500_b100}
	\label{fig:FREM dip}}
	\subfloat[b=0]{
	\includegraphics[width=\wf]{\qd gFREM/images/FREMdip_conjgrad_Lambda500_b0}
	\label{fig:FREM dip b=0}}
	\caption{\f{static} and measured standard deviation ($\sqrt{\var(d)}$) for the estimation of the separation between two simulated noisy static sources ($\Lambda_1=\Lambda_2=500$ photons). A homogeneous background of (a) $b=100$ photons/pixel and (b) $b=0$ photons/pixel was added to each simulated image before realisation of Poisson noise.  \f{static} is shown as a red dashed line. Estimated standard deviation from 1000 different realisation of Poisson noise is plotted with blue circles. (a) \f{static} curve shows a distinct ``dip'' at $300 \unit{nm}$ when background noise is present in the recorded images. (b) For background-free data \f{static} curves are monotonically decreasing. The measured values are under the \f{static} curves due to the initialisation of the maximum-likelihood fitting with $\bm{c}_{true}$ (see discussion in the text).}
	\label{fig:FREM dip both}
\end{figure}
%
The \f{static} formula for static sources derived from \autoref{eq:FI - individual} shows an interesting behaviour for weak sources with large background values. The red dashed curve in \autoref{fig:FREM dip} shows \f{static} for two sources of equal intensity $\Lambda_1=\Lambda_2=500$ photons with background $b=100$ photons/pixel. This parameter settings corresponds to the top line in \autoref{fig:two sources int d}. Contrary to our intuition, \f{static} is not monotonic with separation $d$, and the \f{static} curve shows a ``dip'' at $d\approx300$ nm.

\begin{figure}[!bt]
	\centering
	\newcommand{\wf}{.12\textwidth}
	\newcommand{\dirim}{\qd gFREM/images/psf3/text_twosources_}
	\newcommand{\vs}{.05}
	\begin{tabular}{c|cccccc}
%		\begin{sideways}\hspace{\vs cm}$\Lambda=3000$\end{sideways}
%		&\includegraphics[width=\wf]{\dirim int3000_d50}
%		&\includegraphics[width=\wf]{\dirim int3000_d100}
%		&\includegraphics[width=\wf]{\dirim int3000_d150}
%		&\includegraphics[width=\wf]{\dirim int3000_d200}
%		&\includegraphics[width=\wf]{\dirim int3000_d250}
%		&\includegraphics[width=\wf]{\dirim int3000_d300}\\
		\begin{sideways}\hspace{\vs cm}$\Lambda=500$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int500_d10}
		&\includegraphics[width=\wf]{\dirim int500_d50}
		&\includegraphics[width=\wf]{\dirim int500_d100}
		&\includegraphics[width=\wf]{\dirim int500_d200}
		&\includegraphics[width=\wf]{\dirim int500_d300}
		&\includegraphics[width=\wf]{\dirim int500_d400}\\		
		\begin{sideways}\hspace{\vs cm}$\Lambda=1000$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int1000_d10}
		&\includegraphics[width=\wf]{\dirim int1000_d50}
		&\includegraphics[width=\wf]{\dirim int1000_d100}
		&\includegraphics[width=\wf]{\dirim int1000_d200}
		&\includegraphics[width=\wf]{\dirim int1000_d300}
		&\includegraphics[width=\wf]{\dirim int1000_d400}\\
		\begin{sideways}\hspace{\vs cm}$\Lambda=1500$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int1500_d10}
		&\includegraphics[width=\wf]{\dirim int1500_d50}
		&\includegraphics[width=\wf]{\dirim int1500_d100}
		&\includegraphics[width=\wf]{\dirim int1500_d200}
		&\includegraphics[width=\wf]{\dirim int1500_d300}
		&\includegraphics[width=\wf]{\dirim int1500_d400}\\		
		\begin{sideways}\hspace{\vs cm}$\Lambda=2000$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int2000_d10}
		&\includegraphics[width=\wf]{\dirim int2000_d50}
		&\includegraphics[width=\wf]{\dirim int2000_d100}
		&\includegraphics[width=\wf]{\dirim int2000_d200}
		&\includegraphics[width=\wf]{\dirim int2000_d300}
		&\includegraphics[width=\wf]{\dirim int2000_d400}\\
		\begin{sideways}\hspace{\vs cm}$\Lambda=2500$\end{sideways}
		&\includegraphics[width=\wf]{\dirim int2500_d10}
		&\includegraphics[width=\wf]{\dirim int2500_d50}
		&\includegraphics[width=\wf]{\dirim int2500_d100}
		&\includegraphics[width=\wf]{\dirim int2500_d200}
		&\includegraphics[width=\wf]{\dirim int2500_d300}
		&\includegraphics[width=\wf]{\dirim int2500_d400}\\		
		\hline	
		&$d=10$ & $d=50$ & $d=100$ & $d=200$ & $d=300$ & $d=400$\\
	\end{tabular}
	\caption{Two simulated sources separated by distance $d$ [nm] with intensity $\Lambda$ [total number of emitted photons per source]. The background was set to $b=100$ photons/pixel and the images were corrupted with Poisson noise. The red dots indicate the positions of the sources. Numbers at the top and the bottom of each figure state the ratio (in percent) $r_B=\f{blink}/d\times 100$ and $r_S=\f{static}/d\times 100$ for the blinking and the static situation, respectively, indicating the how many percent of the separation $d$ represents the FREM value. The smaller the values, the higher the precision of the distance estimator. The classical resolution limit $\delta$ (radius of an Airy disk) corresponds to $\delta=320$ nm.}
	\label{fig:two sources int d}
\end{figure}
%
After careful checking of the derivation and the numerical calculations of the curves (see \autoref{sec:Appendix dip comments} in \autoref{app:Appendix2} for details), we interpret the dip to be a result of two competing factors. The first factor is the decrease of \f{static} with increasing separation $d$. This is in accordance with our intuition, that the separation between the sources becomes progressively easier to estimate with increasing distance $d$ between the sources (reducing their mutual overlap). While this is the case for the background-free data \autoref{fig:FREM dip b=0}, the situation is more complicated for data with noisy background. Weak sources can ``disappear'' in the strong background noise if they are well separated (cf. right of the top line in \autoref{fig:two sources int d}). The same sources are easier to detect if they are close, because their overlapping PSFs create a bright object in the noisy background (left of the top line in \autoref{fig:two sources int d}). The ``visibility'' of the sources is the second competing factor, which decreases with $d$. The dip in the \f{static} curves therefore represents an ``optimal separation'' $d$, where the sources are already sufficiently separated to be localised with good precision but still ``visible'' due to their overlapping PSFs. Further increase of the localisation precision with $d$ is not sufficient to compensate for the fact that sources ``disappear'' in noise. Note, that for our simulation ($\lambda_{em}=625\unit{nm}$, $1.2$NA) the Abbe resolution criterion is $260\unit{nm}$.


A qualitative confirmation of this counter-intuitive behaviour is shown on simulated data in \autoref{fig:FREM dip both}. We simulated two sources separated with a distance $d$. The intensity and the background was set to the same values as for the theoretical \f{static} curves ($\Lambda_1=\Lambda_2=500$ photons, $b=100$ photons/pixel, see top row in \autoref{fig:two sources int d}). For each separation $d$ we created $M=1000$ images with different realisation of Poisson noise. Using conjugate gradient optimisation (NETLAB function {\tt conjgrad} \cite{Nabney}), we found the maximum-likelihood estimator of the positions $\bm{c}_{ML}=(c^{ML}_1,c^{ML}_2)$ of two PSFs (see \autoref{eq:intensity pixel}). The initial position for the fitting procedure was set to the true values $\bm{c}_{true}$. The standard deviation of the $M$ estimators $d^{ML}=|c^{ML}_1-c^{ML}_2|$ is plotted with blue circles in \autoref{fig:FREM dip} and shows a ``dip'' similar to the one in the theoretical \f{static} curve. For zero background ($b=0$) \f{static} is monotonically decreasing (the dashed red line in \autoref{fig:FREM dip b=0}). Standard deviation of the $M$ estimators is plotted with blue circles in \autoref{fig:FREM dip b=0}. No dip is observed in this case. 

Note that the measured values of the standard deviation (blue circles) are lower than the theoretical lower bound (red dashed curve). This is likely due to the initialisation of the maximum-likelihood fitting with $\bm{c}_{true}$. Random initialisation would be more appropriate, but the measured standard deviation does not provide curves smooth enough to show the ``dip'' clearly.

\afterpage{\clearpage}
%==========================================
%==========================================


\section{Discussion\label{sec:FREM discussion}}

This section contains a general discussion about FREM and the results presented above. We also discuss and explain the strange behaviour of the original \f{orig} curves. 

In \autoref{sub:LL surface} we give some insight into the behaviour of \f{static} by visualisation of the expected log-likelihood surface. We consider the Fisher information as a measure of the surface's curvature. \Autoref{sub:Int out vs avg} compares the difference between the averaging and integrating over the intensity states $\bm{\Lambda^\alpha}$ in the Fisher information matrix for blinking sources. In \autoref{sub:scaling} we comment on the scaling of FREM with background and the sources' intensity and in \autoref{sub:noise} we shortly discuss noise in the recorded images and in \autoref{sec:comparison to inmf} we make a link to the \inmf{} results. 

%==========================================
\subsection{Visualisation of the expected log-likelihood surface\label{sub:LL surface}}
\begin{figure}[hbt!]
	\centering
	\newcommand{\sizeff}{.18}
	\newcommand{\sizegg}{.16}
	\newcommand{\ndir}{\qd gFREM/images/LLsurface/}
	\begin{tabular}{cccc}
		\subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d300_int11000_int21000_bg100}} 		
		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d200_int11000_int21000_bg100}} 		
		& \subfloat[$d=50$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d50_int11000_int21000_bg100}} 		
		& \subfloat[$d=0$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d0_int11000_int21000_bg100}} 		
		\tabularnewline
		\subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d300_int11000_int21000_bg100}} 
		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d200_int11000_int21000_bg100}} 		
		& \subfloat[$d=50$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d50_int11000_int21000_bg100}} 		
		& \subfloat[$d=0$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d0_int11000_int21000_bg100}} 		
		\tabularnewline
	\end{tabular}
	\caption{Surface of the expected log-likelihood \autoref{eq:Expected log-likelihood} as a function of $\bm{c}=(c_1,\, c_2)$ for different separation $d$ between the two sources, located at $\bm{c}^{true}$ (marked with red dot). The point where the sources exchange their locations is marked with blue cross. The classical resolution limit corresponds to $\delta=320$ nm. Movement along the ``top-left to bottom-right'' diagonal represents moving the points apart (see \autoref{fig:FI space demo} for details).}	
	\label{fig:Expected-log-likelihood-Surface}
\end{figure}

In order to understand the behaviour of the Fisher information matrix, we visualised the surface of the expected log-likelihood \autoref{eq:FREM likelihood Poisson} as a function of the parameter $\bm{c}=(c_1,\, c_2)$ in \autoref{fig:Expected-log-likelihood-Surface}:
%
\begin{alignat}{2}
	\E_{p(n|\lambda^{true})}\left[\mathcal{L}(\bm{c})\right]
	&=\E_{p(n|\lambda^{true})}\left[\sum_{k=1}^N\log p\left(n_k|\lambda_k(\bm{c})\right)\right]\nonumber\\
	&=\sum_{k=1}^N\left(\lambda_k^{true}\log\lambda_k(\bm{c})-\lambda_k(\bm{c})\right)+A.
	\label{eq:Expected log-likelihood}
\end{alignat}
%
Note that the expectation is taken with respect to the ``true'' distribution $\lambda^{true}=\lambda(\bm{c}^{true})$, while the log-likelihood $\mathcal{L}$ is a function of $\bm{c}$. $A$ is independent of $\bm{c}$. 

The surface in \autoref{fig:Expected-log-likelihood-Surface} shows the average log-likelihood for a model with two sources $s_1$ and $s_2$ located at $c_1$ and $c_2$, respectively, for data generated from a model consisting of two sources $s_1^{true}$ and $s_2^{true}$ located at $c_1^{true}$ and $c_2^{true}$, respectively, corrupted with Poisson noise. Parameters of the simulation were $\Lambda=10^3$, $b=100$ and wavelength $625 \unit{nm}$.

\begin{figure}[!tb]
	\newcommand{\wf}{.48\textwidth}
	\centering
	\subfloat[]{\includegraphics[width=\wf]{./figures/FisherInfoSurfaceMovementDemo/FIsurfaceDemo1}\label{fig:FI space demo1}} 
	\subfloat[]{\includegraphics[width=\wf]{./figures/FisherInfoSurfaceMovementDemo/FIsurfaceDemo2}\label{fig:FI space demo2}} \\
	\subfloat[]{\includegraphics[width=\wf]{./figures/FisherInfoSurfaceMovementDemo/FIsurfaceDemo3}\label{fig:FI space demo3}} 
	\subfloat[]{\includegraphics[width=\wf]{./figures/FisherInfoSurfaceMovementDemo/FIsurfaceDemo4}\label{fig:FI space demo4}} 
	\caption{Illustration of the translation of sources $s_1$ and $s_2$ along line $l$ and the corresponding movement in the parameter space from \autoref{fig:Expected-log-likelihood-Surface}.}
	\label{fig:FI space demo}
\end{figure}
%
The correspondence between the $(c_1,c_2)$ space of \autoref{fig:Expected-log-likelihood-Surface} and the physical movement of the sources is illustrated in \autoref{fig:FI space demo}. The coordinates $(c_1,c_2)$ represent the positions of two sources on a line $l$ intersecting both sources $s_1$ and  $s_2$. The origin $o=(0,0)$ corresponds to the geometric centre between $c_1^{true}$ and $c_2^{true}$. Moving along the top-left to bottom-right diagonal (\autoref{fig:FI space demo1}) represents a symmetrical movement of $s_1$ and $s_2$  in opposite directions with respect to $o$, while moving parallel to the top-right to bottom-left diagonal (\autoref{fig:FI space demo2}) represents the translation of $s_1$ and $s_2$ together along $l$, while keeping their distance from each other constant. Moving along a vertical line corresponds to the situation, where the position of $s_1$ fixed while $s_2$ is moving (\autoref{fig:FI space demo3}) and vice versa for horizontal lines (\autoref{fig:FI space demo4}).

For well-separated sources the surface (\autoref{fig:Expected-log-likelihood-Surface}\aaa) has a sharp maximum at $\bm{c}^{true}=(c_1^{true},c_2^{true})$ (red dot in \autoref{fig:Expected-log-likelihood-Surface}\aaa). In fact, there is another equivalent maximum (blue cross in \autoref{fig:Expected-log-likelihood-Surface}\aaa) as the points are interchangeable and the surface is symmetrical along top-right to bottom-left diagonal. It is important to note that the surface falls sharply in all directions around the maximum. In other words, the likelihood of a model $s_1$ and $s_2$ for data generated from $s_1^{true}$ and $s_2^{true}$ drops quickly once the $s_1$ and $s_2$ move anywhere from the ``true'' locations $\bm{c}^{true}$.

Once the true sources $s_1^{true}$ and $s_2^{true}$ come closer together (\autoref{fig:Expected-log-likelihood-Surface}\bbb,\ccc), the maximum of the surface becomes less pronounced, especially along the top-left to bottom-right diagonal. The likelihood of a model $s_1$ and $s_2$ is not very sensitive to small symmetrical movement of $s_1$ and $s_2$ with respect to $o=(0,0)$. 

Once the sources $s_1^{true}$ and $s_2^{true}$ get very close, the saddle point in $o$ disappears and turns into a flat crest (\autoref{fig:Expected-log-likelihood-Surface}\ddd). The likelihood becomes insensitive to small variations of $s_1$ and $s_2$. 

The Fisher information matrix \autoref{eq:Fisher information general} describes the curvature (Hessian) at $\bm{c}^{true}$ (red dot in \autoref{fig:Expected-log-likelihood-Surface}\aaa). For well-separated sources \autoref{fig:Expected-log-likelihood-Surface}\aaa{}, the curvature is very high in all directions, resulting in a large determinant of the Hessian matrix, which in turn results in a small variance $\var(d)$ of the distance $d=\left|c_1^{true}-c_2^{true}\right|$ estimation  (see \autoref{eq:inverse I}). Once the ``true'' sources get closer, the curvature at the surface maximum decreases leading to larger $\var(d)$. For very close ``true'' sources, the determinant of Hessian becomes zero, and the lower bound on $\var(d)$ diverges. 

The situation of infinitely close sources $c_1^{true}=c_2^{true}$, shown in \autoref{fig:Expected-log-likelihood-Surface}\ddd{}  is equivalent to the situation with one source of double intensity and the second source missing, resulting in a divergence of $\var(d)$ in accordance with our discussion of \autoref{eq:FI - individual} of the limit $d\rightarrow 0$ (see \autoref{sec:Appendix FI alternative} in \autoref{app:Appendix2}).

\begin{figure}[!thb]
	\centering
	\newcommand{\sizeff}{.18}
	\newcommand{\sizegg}{.16}
	\newcommand{\ndir}{\qd gFREM/images/LLsurface/}
	\begin{tabular}{cccc}
		\subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d300_int11000_int22000_bg100}} 		
		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d200_int11000_int22000_bg100}} 		
		& \subfloat[$d=50$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d50_int11000_int22000_bg100}} 		
		& \subfloat[$d=0$ nm]{\includegraphics[scale=\sizegg]{\ndir surf_d0_int11000_int22000_bg100}} 		
		\tabularnewline
		\subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d300_int11000_int22000_bg100}} 
		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d200_int11000_int22000_bg100}} 		
		& \subfloat[$d=50$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d50_int11000_int22000_bg100}} 		
		& \subfloat[$d=0$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d0_int11000_int22000_bg100}} 		
		\tabularnewline
	\end{tabular}
	\caption{Surface of the expected log-likelihood \autoref{eq:Expected log-likelihood} as a function of $\bm{c}=(c_1,\, c_2)$ for different separations $d$ between two sources of unequal intensity $\Lambda_2=2\Lambda_1$, located at $\bm{c}^{true}$ (marked with a red dot). The position where the sources exchange their true locations is marked with a blue cross.}	
	\label{fig:LL surf different intensity}
\end{figure}
%
The symmetry of the surface breaks when we consider two sources with unequal intensity ($\Lambda_1\neq\Lambda_2$), because such sources are no longer interchangeable. The situation for $\Lambda_2=2\Lambda_1$ is shown in \autoref{fig:LL surf different intensity}. The displacement of the stronger source ($s_2$), which corresponds to the movement along the vertical lines in \autoref{fig:LL surf different intensity}\eee-\hhh{} (see \autoref{fig:FI space demo} for explanation), has a dramatic effect on the likelihood of the model. The surface drops steeply in the horizontal direction, while it decreases rather slowly along the horizontal line (displacement of the weaker source $s_1$). For the limit $d\rightarrow 0$, shown in \autoref{fig:LL surf different intensity}\ddd,\hhh, the flat crest in the origin still exists (which results in a divergence of $\var(d)$), however it is not aligned with the top-left to bottom-right diagonal as for the equal sources (see \autoref{fig:Expected-log-likelihood-Surface}\ddd,\hhh). There is a non-zero curvature along this diagonal.

The Fisher information for the original \f{orig} formula \autoref{eq:Ram FREM} is derived from the curvature of the surface along the top-left to bottom-right diagonal (symmetrical displacement of the sources with respect to the origin cf. \autoref{fig:FI space demo}). For the symmetrical situation $\Lambda_1=\Lambda_2$ the original \f{orig} gives the correct results (see \autoref{app:Appendix2} for a mathematical explanation), however, for the asymmetrical case $\Lambda_1\neq\Lambda_2$ the non-zero curvature along the diagonal results in finite \f{orig} even for the limit $d\rightarrow 0$. Our proposed derivation of \f{static} from the Fisher information matrix (see \autoref{eq:var d from Q}) accommodates for the unequal sources correctly and gives diverging \f{static} for this limit. 

%==========================================

\subsection{Blinking vs static sources\label{sub:Blink vs static}}

\Autoref{fig:FREM static blinking} and \autoref{fig:FREM int bg} suggest that the intensity blinking can facilitate localisation of closely separated sources when compared to the static situation. The difference is more pronounced for data with high signal-to-noise ratio (low $b/\Lambda$). Quantum dots with intermittent intensity and an order of magnitude higher brightness than the organic fluorophores are therefore interesting for localisation microscopy even from a theoretical point of view.

%==========================================

\subsection{Integrating out $\Lambda$ vs averaging\label{sub:Int out vs avg}}
\begin{figure}[!hbt]
	\centering
	\newcommand{\wf}{.49\textwidth}
		\includegraphics[width=\wf]{\qd gFREM/images/FREM_intoutVSavg_longrange_bg100fix}
%		\subfloat[FREM (fixed $b=$100 phot/pixel)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_intoutVSavg_bg100fix}}
%		\subfloat[Ratio of the curves form (a)]{\includegraphics[width=\wf]{\qd gFREM/images/FREM_intoutVSavg_ratio_bg100fix}}
		
%	\caption{(a) Comparison of FREM computed from the Fisher information with integration over the states within the log-likelihood function \autoref{eq:FREM likelihood Lambda integrated out} (dashed lines) and the averaging of the Fisher information over different intensity states $\Lambda^{\alpha}$ \autoref{eq:FI avg} (solid lines). Dotted black lines corresponds to FREM$=d$ border. (b) Ratio of the ``sum'' (solid) to ``averaging'' (dashed) FREM curves. It shown how many times is the ``averaging'' FREM smaller than FREM derived from integrating over the states in the Fisher information matrix.}
	\caption{Comparison of \f{blink} computed from the Fisher information with integration over the states within the log-likelihood function \autoref{eq:FREM likelihood Lambda integrated out} (dashed lines) and the averaging of the Fisher information over different intensity states $\Lambda^{\alpha}$ \autoref{eq:FI avg} (solid lines). Background was set to $b=100$ phot/pixel. Dotted black line corresponds to \f{blink}$=d$.}
	\label{fig:FREM int out vs avg}
\end{figure}
% 
As we pointed out in \autoref{sec:FREM for blinking}, in the real situation we do not know the intensity states $\bm{\Lambda^{\alpha}}$ of the individual emitters in each frame (see \autoref{eq:intensity states}). We have to therefore integrate (sum) over these states within the likelihood function \autoref{eq:FREM likelihood Lambda integrated out}, rather than average the Fisher information over different configurations of $\bm{\Lambda^{\alpha}}$ as in \autoref{eq:FI avg}. 

To further emphasise the difference between the ``integrating over states in'' and ``averaging of'' the Fisher information we plot \f{blink} as a function of the separation $d$ for both concepts in \autoref{fig:FREM int out vs avg}.

\f{blink} computed from the averaged Fisher information is consistently lower for the whole range of $d$. It is also lower than the \f{static} curves for static sources (solid lines in \autoref{fig:FREM ratio fixed bg}), which in certain region cross the \f{blink} corresponding to the blinking sources (dashed lines in \autoref{fig:FREM ratio fixed bg}). In other words, if we {\it knew} the intensity configurations $\bm{\Lambda}^{\alpha}$ of the blinking sources in each recorded frame, we would be able to reach the highest estimation precision. In the blinking situation with the probabilistic description of the intensity states, the integration (summation) over all possible states is required and the estimation precision is lower. 

Note, that the averaging approach does not results in divergence of the \f{blink} for the $d\rightarrow 0$ limit (see \autoref{fig:FREM int out vs avg}\aaa). This is due to the fact that we assume the configuration of the intensity state in each frame to be {\it known}. We can therefore determine the position of each source individually from the frames, where only one source is emitting ($\bm{\Lambda^{\alpha=1}}$ and $\bm{\Lambda^{\alpha=2}}$ in \autoref{eq:intensity states}). The averaging \autoref{eq:FI avg} fills in the (otherwise zero) diagonal entries of the Fisher information matrix with non-zero values and we get a finite precision for the separation estimation even when $d=0$.

%==========================================

\subsection{Scaling of FREM for different levels of intensity and background\label{sub:scaling}}

The Fisher information matrix \autoref{eq:FI - individual - equal strength} for two sources with equal (static) intensity $\Lambda_1=\Lambda_2=\Lambda$ suggests that increasing the intensity of the sources by a factor of $M$, leads to approximately $M$ times higher Fisher information matrix entries (and therefore a $\sqrt{M}$ times lower FREM). More precisely, the dependency of the entries on the intensity and the background is as follows
%
\begin{equation}
	\left\{I_{\Lambda,b}^{static}\right\}_{ij}=\Lambda\frac{A}{B+b/\Lambda},
	\label{eq:FI static on lambda b}
\end{equation}
%
where $A$ and $B$ are independent of $\Lambda$ and $b$. The subscripts $\Lambda,\,b$ in $I_{\Lambda,b}$ express the parametric dependency of the Fisher information on the intensity and background values.  Note that the background and the intensity appear as a ratio $b/\Lambda$ in \autoref{eq:FI static on lambda b}, but the whole expression is multiplied by $\Lambda$. An $M$ fold increase of the acquisition time leads to an $M$ fold increase of both the total number of emitted photons and the background $b$. In this case we get a $\sqrt{M}$ fold decrease of \f{static}. For zero background $b=0$ 
%
\begin{equation}
	\f{static}\propto\frac{1}{\sqrt{\Lambda}}.
\end{equation}

The scaling with $\Lambda$ and $b$ of the Fisher information entries for the blinking case is more complicated. In \autoref{app:Appendix2} we show, that the blinking situation gives results equal to the static situation (up to a factor of 1/2, accounting for half of the total number of emitted photons) for the limit of well-separated sources ($d\rightarrow\infty$) and zero background (see \autoref{eq:app-FREM blink lim infty b=0} in \autoref{app:Appendix2}). In the non-zero background situation, $b$ appears within the arguments of Poisson terms organised in a complicated fraction (see \autoref{eq:app-FREM blink limit infty bg} in \autoref{app:Appendix2}) and the dependence of the Fisher information matrix entries on the background is therefore highly non-linear.  

%==========================================

\subsection{A note on noise\label{sub:noise}}

The Poisson distribution models noise associated with the photon detection \cite{PawleyHandbook2006}. This noise, derived from the nature of the signal itself, is often called ``shot noise'' \cite{Schottky1918} and is present even under ideal imaging conditions free of any noise introduced by the sensor. Noise introduced by the sensor is usually divided into two components: the dark noise (or dark current), which represents the electrons thermally generated in the detector, and the read-out noise (or read noise) associated with analogue-to-digital conversion of the signal. The dark noise (Poisson distributed) is efficiently eliminated by the cooling of the sensor and is negligible in high-performance cameras.  The read-out noise is assumed to follow a Gaussian distribution and is characterised by a standard deviation (often called r.m.s.).  The read-out noise depends on the read-out frequency and can be reduced by optimising the design of the detector's electrical circuits. The standard deviation of the read-out noise for a typical scientific CCD camera is 5-10 electrons. 

We assume Poisson distributed data throughout this chapter. We therefore neglect the read-out noise of the sensor and assume only the shot noise to be present in the recorded images. Ram et al. \cite{Ram2006} shows a modification of the Fisher information for a model combining both Poisson (shot) and Gaussian (read-out) noise.

%==========================================

\subsection{Comparison to \inmf{} results\label{sec:comparison to inmf}}
%
In \autoref{sec:FREM} I mentioned that the standard deviation lower bound can be achieved only with the ``optimal'' algorithm. In \autoref{sec:Discussion} we discussed on simulated data that \inmf{} can separate two sources as close as $40$~nm for sources with intensity $500$~photons/source/frame and background $100$~photons/pixel/frame. These parameters correspond to the dashed green curve in \autoref{fig:FREM fixed bg}. The "natural" resolution limit (intersection with the blacked dotted line - \f{blink}=$d$) for this parameters is $\sim20$~nm. We see that \inmf{} is sub-optimal algorithm from this point of view.
\afterpage{\clearpage}
%==========================================
%==========================================

\section{Conclusions} 

The alternative derivation of the fundamental resolution measure (\f{static}) provides correction to the original formula published by Ram et al. \cite{Ram2006}. The results presented in \autoref{fig:FREM static blinking} suggest that the blinking sources can significantly increase localisation precision compared to the static situation if the total number of emitted photons is kept equal. The increase of the localisation precision for blinking sources is stronger for close ($d<50\unit{nm}$) and bright ($\Lambda>1000$ photons/source/frame) sources with lower background levels ($b<100$ photons/pixel/frame). For well-separated sources ($d\rightarrow\infty$) the static and the blinking situations give identical results. 

Background has a large impact on the localisation precision. It is desirable to keep background as low as possible. In practice a large proportion of the background intensity comes from the out-of-focus light. Typically TIRF (Total Internal Reflection Fluorescent microscopy) illumination of the sources is used to reduce the out-of-focus blur. However, different techniques such as sparse illumination of the sample can be used. 

Note that the \CR lower bound approach gives a lower bound for the variance of the distance $d$ estimator. The actual ``localisation precision'' depends on the specific algorithm we use for localising the individual sources. For example, our proposed LM algorithm discussed in \autoref{ch:NMF} computationally separates the overlapping sources before localisation. The ability to separate the individual emitters is the limiting factor in this case. It is also important to note that the ``localisation'' becomes much harder with increasing number of emitters in the sub-diffraction area. The pixellation it taken into account through \autoref{eq:intensity pixel}.

In summary bright sources with low background levels (high signal-to-noise ratio) are desirable for the LM techniques. In this setting the blinking provides lower FREM values for closely spaced sources. This makes bright sources with intermittent intensity, such as quantum dots, an interesting candidate for localisation microscopy.


%\begin{figure}[thb]
%	\centering
%	\newcommand{\sizeff}{.18}
%	\newcommand{\sizegg}{.16}
%	\newcommand{\ndir}{\qd gFREM/images/LLsurface/}
%	\begin{tabular}{cccc}
%		\subfloat[$d=400$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d400_int11000_int21000_bg100}} 
%		& \subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d300_int11000_int21000_bg100}} 		
%		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d200_int11000_int21000_bg100}} 		
%		& \subfloat[$d=100$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d100_int11000_int21000_bg100}} 		
%		\tabularnewline
%		\subfloat[$d=400$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d400_int1500_int2500_bg100}} 
%		& \subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d300_int1500_int2500_bg100}} 		
%		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d200_int1500_int2500_bg100}} 		
%		& \subfloat[$d=100$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d100_int1500_int2500_bg100}} 		
%		\tabularnewline
%		\subfloat[$d=400$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d400_int1500_int2500_bg500}} 
%		& \subfloat[$d=300$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d300_int1500_int2500_bg500}} 		
%		& \subfloat[$d=200$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d200_int1500_int2500_bg500}} 		
%		& \subfloat[$d=100$ nm]{\includegraphics[scale=\sizegg]{\ndir cont_d100_int1500_int2500_bg500}} 		
%
%	\end{tabular}
%	\caption{Top row: int=1000, bg=100; bottom int=1000, bg=100}	
%\end{figure}
%



%% This is for discussion
%In the blinking case \autoref{eq:Fisher Information Blinking Integrating Out} the dependency on $\Lambda$ is complicated as the expectation in \autoref{eq:Fisher Information Blinking Integrating Out} cannot be simplified and $\var(d)$ depends on $\Lambda$ through the parameter $\lambda_k^i(\Lambda)$ of the Poisson distribution in \autoref{eq:Fisher Information Blinking Integrating Out}. This gives rise to a non-linear relationship between $\var(d)$ and $\Lambda$.
%%
%The comparison of the blinking and the static case for three different values of the mean source intensity $\Lambda$ is shown in \autoref{fig:FREM static blinking}\aaa. In this figure the background intensity was fixed to $bg=100$~photons. The intensity of the blinking sources was set to $2\Lambda$ to keep the mean number of detected photons constant for the static and the blinking case (the blinking sources are on average `ON' only half of the time and so the average intensity is $\Lambda$). 
%
%Localisation precision $\sqrt{\var(d)}$ for two sources separated by 40~nm with equal intensities $\Lambda=10^3$ photons for different background levels is shown in \autoref{fig:effect of the background and illustration of the noisy sources with background}\aaa. This graph correspond to two sources separated by $d=40$~nm with $\Lambda=10^3$~photons ($2\Lambda$ for blinking case). For lower background ($bg<200$) the blinking sources allow higher localisation precision (lower $\var(d)$). Illustration of this data with different background levels is shown in \autoref{fig:effect of the background and illustration of the noisy sources with background}b-e. 
%
%%==========================================
%%==========================================
%
